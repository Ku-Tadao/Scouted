---
import { SVG_ICONS } from '@/lib/icons';
import type { TFTTrait } from '@/lib/types';

interface Props {
  traits: TFTTrait[];
}

const { traits } = Astro.props;

const typeLabels: Record<string, string> = {
  origin: 'Region',
  class: 'Class',
  unique: 'Unique',
  teamup: 'Team-Up',
};
---

<section id="traits" class="content" style="display:none">
    <div class="section-header">
        <h2>Traits</h2>
        <div class="search-filter">
            <span class="search-icon"><Fragment set:html={SVG_ICONS.search} /></span>
            <input type="text" id="traitSearch" placeholder="Search traits..." />
        </div>
    </div>

    <div class="traits-grid">
        {traits.map(trait => {
            const MAX_SHOWN = 6;
            const shown = trait.champions.slice(0, MAX_SHOWN);
            const overflow = trait.champions.length - MAX_SHOWN;
            const hidden = overflow > 0 ? trait.champions.slice(MAX_SHOWN) : [];
            return (
            <div class="trait-card" data-trait-key={trait.key} data-trait-name={trait.name.toLowerCase()}>
                <div class="trait-card-header">
                    {trait.icon && <img src={trait.icon} alt="" loading="lazy" class="trait-icon" />}
                    <div class="trait-card-title">
                        <h4 class="trait-name">{trait.name}</h4>
                        <span class={`trait-type-badge trait-type-${trait.type}`}>{typeLabels[trait.type] ?? trait.type}</span>
                    </div>
                </div>
                {trait.desc && (
                    <p class={`trait-desc${trait.descDetails.length > 0 ? ' has-details' : ''}`}>{trait.desc.replace(/<br>/g, ' ')}</p>
                )}
                <div class="trait-breakpoints">
                    {trait.effects.map(e => (
                        <span class={`bp-badge bp-style-${e.style}`}>{e.minUnits}</span>
                    ))}
                </div>
                {trait.descDetails.length > 0 && (
                    <div class="trait-details" style="display:none">
                        {trait.descDetails.map(row => (
                            <div class="trait-detail-row">
                                <span class={`bp-badge bp-style-${row.style}`}>{row.minUnits}</span>
                                <span class="trait-detail-text">{row.text}</span>
                            </div>
                        ))}
                    </div>
                )}
                {trait.champions.length > 0 && (
                    <div class="trait-champ-list">
                        {shown.map(ch => (
                            <button class="trait-champ-entry" data-champ-id={ch.id} type="button" title={ch.name}>
                                {ch.icon && <img src={ch.icon} alt="" loading="lazy" class="trait-champ-portrait" />}
                                <span class="trait-champ-name">{ch.name}</span>
                            </button>
                        ))}
                        {overflow > 0 && (
                            <button class="trait-champ-more" type="button" data-expanded="false" title="Show all champions">+{overflow}</button>
                        )}
                        {hidden.length > 0 && (
                            <div class="trait-champ-overflow" style="display:none">
                                {hidden.map(ch => (
                                    <button class="trait-champ-entry" data-champ-id={ch.id} type="button" title={ch.name}>
                                        {ch.icon && <img src={ch.icon} alt="" loading="lazy" class="trait-champ-portrait" />}
                                        <span class="trait-champ-name">{ch.name}</span>
                                    </button>
                                ))}
                            </div>
                        )}
                    </div>
                )}
            </div>
            );
        })}
    </div>
</section>
